<!DOCTYPE html>
<!-- saved from url=(0044)https://cs0449.gitlab.io/fa2024/projects/01/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Project 1 - Hiding data | CS 449</title>
<meta name="generator" content="Jekyll v3.7.4">
<meta property="og:title" content="Project 1 - Hiding data">
<meta property="og:locale" content="en_US">
<meta name="description" content="Steganography">
<meta property="og:description" content="Steganography">
<link rel="canonical" href="https://cs0449.gitlab.io/fa2024/projects/01/">
<meta property="og:url" content="https://cs0449.gitlab.io/fa2024/projects/01/">
<meta property="og:site_name" content="CS 449">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-12-04T20:03:49+00:00">
<script type="application/ld+json">
{"description":"Steganography","headline":"Project 1 - Hiding data","dateModified":"2024-12-04T20:03:49+00:00","datePublished":"2024-12-04T20:03:49+00:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://cs0449.gitlab.io/fa2024/projects/01/"},"url":"https://cs0449.gitlab.io/fa2024/projects/01/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="./Project 1 - Hiding data _ CS 449_files/main.css"><link type="application/atom+xml" rel="alternate" href="https://cs0449.gitlab.io/fa2024/feed.xml" title="CS 449"></head>
<body data-new-gr-c-s-check-loaded="14.1092.0" data-gr-ext-installed=""><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="https://cs0449.gitlab.io/fa2024/">CS 449</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="https://cs0449.gitlab.io/fa2024/aboutme">Luis Oliveira</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/general">General Info</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/syllabus/">Syllabus</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/schedule">Schedule</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/resources/">Resources</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/forfun/">For Fun</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/labs/">Labs</a><a class="page-link" href="https://cs0449.gitlab.io/fa2024/projects/">Projects</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
<h1>Project 1 - Hiding data: Reading files</h1>

<p>
<strong>Released</strong>: 23:59 Thursday, September 26th, 2024.
</p>


<p>
<strong>Due</strong>: 17:59 Friday, October 11th, 2024.
</p>


<p>
Let's hide images within images!

</p>


<h1 id="steganography">Steganography</h1>

<p>The art of secret writing; cryptography. Also, cryptographic script, cipher.</p>

<ul>
  <li>OED - https://www.oed.com/view/Entry/189651</li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>Can you tell the difference between these two images?</p>

<p><img src="./Project 1 - Hiding data _ CS 449_files/pepper_zero.bmp" alt="Pepper dark"></p>

<p><img src="./Project 1 - Hiding data _ CS 449_files/pepper_ff.bmp" alt="Pepper light"></p>

<p>Perhaps one is over-exposed (too bright)? And the other under-exposed (too dark)?
Well, it may be obvious by comparison, but alone they would just be normal pictures. And that’s something we can take advantage of :)
Small changes to image data, while visually obvious, don’t really affect the subject captured significantly. Both images above have had 50% of the image data changed from the original. And depite all of thoses changes you can still clearly see the image!</p>

<p>Perhaps we can cleverly change images to hide data! Sounds fun?</p>

<p>Ok, let’s do it!</p>

<h1 id="bmp-images">BMP images</h1>

<p>A Bitmap Image File (typical extension: .bmp) is a container format for a big array of pixels (picture cells). There are a variety of ways that BMP files can encode image data, but we will focus on one particular form and write a program that performs two simple image transformations: Hide an image within another, and reveal that image.</p>

<p>Bitmaps can have many different formats, but in this assignment, we will be assuming Windows Bitmap files whose contents are 24-bit RGB color. This means that each pixel is represented by a 24-bit number, split into three 8-bit parts. The first part is the intensity of the color blue, the second is the intensity of the color green, and the third is the intensity of the color red, each expressed as an integer value from 0-255.</p>

<h2 id="structure-of-a-bmp-file">Structure of a BMP file</h2>

<p>Your first step is to read and validate that the specified file is a BMP in a format we can handle. The first 14 bytes of all valid bitmap files begin with a “header” described in the table below:</p>

<table>
  <thead>
    <tr>
      <th><strong>Offset</strong></th>
      <th><strong>Length</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2</td>
      <td>Format identifier (magic number)</td>
    </tr>
    <tr>
      <td>2</td>
      <td>4</td>
      <td>Size of the file in bytes</td>
    </tr>
    <tr>
      <td>6</td>
      <td>2</td>
      <td>A two-byte reserved value</td>
    </tr>
    <tr>
      <td>8</td>
      <td>2</td>
      <td>Another two-byte reserved value</td>
    </tr>
    <tr>
      <td>10</td>
      <td>4</td>
      <td>Offset to the start of the pixel array</td>
    </tr>
  </tbody>
</table>

<p>In your program, this header should be represented as a structure, which can then be read from the file using <code class="highlighter-rouge">fread</code>.</p>

<p>For the project, make sure that your format is <code class="highlighter-rouge">BM</code> by verifying that the format contains those two <strong>upper-case</strong> letters. Be careful, there is no NUL terminator since it’s not a proper string! If the value in the format is not <code class="highlighter-rouge">BM</code>, display an error message that we do not support the file format, and exit.</p>

<p>After the file header, you’ll find another header! called “DIB header” (DIB - Device Independent Bitmap). This bitmap describes how the actual image is stored in the file, for example how each pixel is represented.</p>

<table>
  <thead>
    <tr>
      <th><strong>Offset</strong></th>
      <th><strong>Length</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4</td>
      <td>Size of this DIB header in bytes</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>Width of the image in pixels</td>
    </tr>
    <tr>
      <td>8</td>
      <td>4</td>
      <td>Height of the image in pixels</td>
    </tr>
    <tr>
      <td>12</td>
      <td>2</td>
      <td>Number of color planes (don’t worry)</td>
    </tr>
    <tr>
      <td>14</td>
      <td>2</td>
      <td>Number of bits per pixel</td>
    </tr>
    <tr>
      <td>16</td>
      <td>4</td>
      <td>Compression scheme used</td>
    </tr>
    <tr>
      <td>20</td>
      <td>4</td>
      <td>Image size in bytes</td>
    </tr>
    <tr>
      <td>24</td>
      <td>4</td>
      <td>Horizontal resolution</td>
    </tr>
    <tr>
      <td>28</td>
      <td>4</td>
      <td>Vertical resolution</td>
    </tr>
    <tr>
      <td>32</td>
      <td>4</td>
      <td>Number of colors in the palette</td>
    </tr>
    <tr>
      <td>36</td>
      <td>4</td>
      <td>Number of important colors</td>
    </tr>
  </tbody>
</table>

<p>Again, this header can be represented as a C struct and read from the file. Most of these fields will not be used in our program, so don’t worry about understanding all of them.
Just make the struct, create an instance, and <code class="highlighter-rouge">fread</code> it in.</p>

<p>What you need to check:</p>

<ol>
  <li>Check that the size of the DIB header (that first field in this struct) is 40. It could be other values and if so, once again, display an error message that we do not support the file format, and exit.</li>
  <li>If our program gets to this point, we have a BMP that we can read. Let us ensure that the pixel data is encoded in 24-bit RGB by testing the bits per pixel field of our DIB header against 24. If it is any other value, display an error message that we don’t support the file format, and exit.</li>
</ol>

<p>Now, we can be confident our file has the data we understand and can work with.</p>

<p>Use <code class="highlighter-rouge">fseek</code> to move the file pointer to the location specified in the original BMP header as the offset of the start of the pixel array. We are now ready to process the individual pixels.</p>

<h2 id="the-pixel-array">The Pixel Array</h2>

<p>Each pixel is three 8-bit integers, representing blue, green, and red intensity on a scale of 0-255. Create a pixel struct with the appropriate fields:</p>

<table>
  <thead>
    <tr>
      <th><strong>Offset</strong></th>
      <th><strong>Length</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>Blue intensity</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>Green intensity</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>Red intensity</td>
    </tr>
  </tbody>
</table>

<p>The pixels are laid out in the file row by row (in upside-down, bottom row of the image first, order, for reasons we don’t care about nor will it affect our program).</p>

<p>The number of rows is the height as specified in the DIB header and the number of pixels per row is the width from the DIB header.</p>

<p>Use <code class="highlighter-rouge">fread</code> to read in each pixel, transforming it according to the project requirements, and use <code class="highlighter-rouge">fwrite</code> to write it back to the file. Note that in doing the <code class="highlighter-rouge">fread</code>, the file pointer is advanced, so if you do an <code class="highlighter-rouge">fwrite</code> you’ll actually be overwriting the neighboring pixel. To fix this, you can rewind the file backwards using <code class="highlighter-rouge">fseek</code> relative to the current position.</p>

<p>We do it this way so that we do not need to worry about creating a new, valid BMP file. We will just reuse the original one’s headers without modification, since our transformations never alter the size of the image or anything else recorded in the header.</p>

<p>There is one major quirk with reading the pixel array. The BMP format requires that a single row of pixels be a multiple of 4 bytes. But each pixel is 3 bytes, and 3 * width is not guaranteed to be a multiple of 4. If that’s the case, extra empty padding bytes are used to force the next pixel row to start at an offset that is a multiple of 4. At the end of reading a row, calculate how many padding bytes are present, and use <code class="highlighter-rouge">fseek</code> to skip them, before looping back to process the next row.</p>

<p><img src="./Project 1 - Hiding data _ CS 449_files/pixel_layout.png" alt="Pixel layout on a BMP file"></p>

<h1 id="revealing-the-secret">Revealing the secret!</h1>

<h2 id="how-does-it-work">How does it work?</h2>

<p>RGB (or BGR) is a color representation that stores a mix of three colors, allowing for the representation if many colors all across the visible spectrum. How many slight variations we can represent depends on how much detail we allow the image to store. If we store more bits, we can represent more color variations using more space; conversely, if we store less bits, we have coarser grained color representations but save space. We call the number bits per pixel bit-depth, for example a 24-bit color, is one where each pixel is represented with 24 bits. And if each pixel is composed by 3 colors, that means that each color gets 8 bits! E.g., orange can be represented by <code class="highlighter-rouge">R: 0xFF, G: 0x80, B: 0x00</code>, or merged into a single value <code class="highlighter-rouge">0xFF8000</code>, or if you are a web-page <code class="highlighter-rouge">#FF8000</code>.</p>

<p>Now, back to those images.
The dark image had the 4 LSB (Least significant bits) of each color set to 0x0.
The light image had the 4 LSB (Least significant bits) of each color set to 0xF.</p>

<p>Here is an example with orange text:</p>

<p class="orange">Hello (R: 0xFF, G: 0x80, B: 0x00)</p>

<p class="darkorange">Hello (R: 0xF0, G: 0x80, B: 0x00)</p>

<p class="lightorange">Hello (R: 0xFF, G: 0x8F, B: 0x0F)</p>

<p>If such a significant change of the 4 LSB produces such a small difference in perceived color, then we can hide something more interesting in those bits. For example a whole other image!!!!</p>

<p><img src="./Project 1 - Hiding data _ CS 449_files/pepper_secret.bmp" alt="Pepper secret"></p>

<p>Can you see it? No? Well, let’s write a program that can reveal the secret!</p>

<h2 id="what-are-you-programming">What are you programming?</h2>

<p>For your project, you will build a C program that reads a BMP file, and reveals any secrets stored in them!! :)</p>

<p>Then, you will extend your program to be able to hide an image in another.</p>

<p>The secret image will be stored as the 4 LSB of a 24-bit BMP file. Such that for each pixel stored, the first half of the number are the 4MSB of the decoy image (the one you actually see), and the second half of the number are the 4MSB of the secret message. As we saw above, the secret message can go unnoticed, at least for images with multiple colors! Check the example below. Each color is 8bits!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    Mixed image: B: 0xIJ, G: 0xKL, R: 0xMN
    Decoy image: B: 0xI0, G: 0xK0, R: 0xM0
    Secret image: B: 0xJ0, G: 0xL0, R: 0xN0
</code></pre></div></div>

<h2 id="your-turn">Your turn</h2>

<p>Step 1. I suggest you complete it this week!</p>

<table class="question">
  <tbody>
    <tr>
      <td><strong>A.1 (2 points): Implement a C program that can be called with the following arguments and displays both headers. Check the example output for the error messages you should print (EXACTLY! after all the autotester is dumb :)</strong></td>
    </tr>
  </tbody>
</table>

<p><strong>NOTE:</strong> The values are just an example, and the files provided may or may not print the same values!!</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./bmp_steganography --info file_that_doesnt_exist.bmp
ERROR: File not found.
$ ./bmp_steganography --info wrong_file_type.bmp
ERROR: The format is not supported.
$ ./bmp_steganography --info wrong_file_type.bmp
ERROR: The format is not supported.
$ ./bmp_steganography --info
ERROR: Missing arguments.
$ ./bmp_steganography --info supported_bmp_file.bmp
=== BMP Header ===
Type: BM
Size: 2073654
Reserved 1: 0
Reserved 2: 0
Image offset: 54

=== DIB Header ===
Size: 40
Width: 960
Height: 720
# color planes: 1
# bits per pixel: 24
Compression scheme: 0
Image size: 2073600
Horizontal resolution: 7559
Vertical resolution: 7559
# colors in palette: 0
# important colors: 0
</code></pre></div></div>

<p>Step 2. I suggest you complete this AT LEAST 2 days before the deadline, to give you time to complete the last step.</p>

<table class="question">
  <tbody>
    <tr>
      <td><strong>A.2 (4 points): Extend your C program so that it can be called with the following arguments and reveals the hidden image</strong></td>
    </tr>
  </tbody>
</table>

<p>Again, make sure you print the appropriate error messages (same as in the previous question!)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./bmp_steganography --reveal FILENAME
</code></pre></div></div>

<p>Make your program read each BGR color stored in the BMP file, and swap its 4MSB with its 4LSB (swap the decoy and hidden images).
If you run your program multiple times on the same image, it will flip back-and-forth between those 2 images.</p>

<p><strong>Note that the program modifies the input file!!</strong> This is expected.</p>

<table class="question">
  <tbody>
    <tr>
      <td><strong>A.3 (2 points): Extend a C program that can be called with the following arguments and hides FILENAME2 in the image in FILENAME1</strong></td>
    </tr>
  </tbody>
</table>

<p>Again, make sure you print the appropriate error messages (same as in the previous question!)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./bmp_steganography --hide FILENAME1 FILENAME2
</code></pre></div></div>

<p>For the last part, your program needs to hide FILENAME2 in the 4LSB of each pixel in FILENAME1.
To make the implementation simpler, make sure both images have the same width and height and throw an error otherwise.</p>

<p><strong>Note that the program modifies FILENAME1!</strong> Again, this is expected, so make sure you have a backup copy of the original.</p>

<table class="question">
  <tbody>
    <tr>
      <td><strong>A.4 (1 points): Create a Makefile whose default behaviour when called (i.e. without arguments) is compile your code into an executable named bmp_steganography</strong></td>
    </tr>
  </tbody>
</table>

<p><strong>Note</strong>: CAPITAL M in <code class="highlighter-rouge">Makefile</code> !!</p>

<p class="blink">If you don’t provide a Makefile, you cannot use multiple files in your solution!
All code must be in a single file named <code class="highlighter-rouge">bmp_steganography.c</code></p>

<table class="question">
  <tbody>
    <tr>
      <td><strong>A.5 (1 points): [Manually graded!] Use a good programming style with all code indented, code commented, using functions appropriately, and naming functions and variables in a legible way.</strong></td>
    </tr>
  </tbody>
</table>

<h1 id="hints">Hints</h1>

<h2 id="arguments-for-a-c-program">Arguments for a C program</h2>

<p>The <code class="highlighter-rouge">main</code> function on your C programs can accept 2 arguments:</p>
<pre><code class="language-C">int main(int argc, char *argv[]);
</code></pre>

<p>The first, is called the “argument count” and it tells you how many arguments your program received.
The second, is called the “argument vector” and is an array of strings! each being a different argument!</p>

<p>The first argument you receive is always the program being invoked, why? (We’ll explore that in a later project).
So <code class="highlighter-rouge">argc</code> is expected to be greater or equal to 1.</p>

<p>Write a simple program that prints all arguments (a for loop with a printf is enough). That will help you understand how to access the values.</p>

<p>For the project, you can use your str* functions to parse those inputs.</p>

<h2 id="on-the-compactness-of-structs">On the compactness of structs</h2>

<p>Remember how the struct sizes were weird in Lab 1? Well you can make sure there is no padding between elements by writting this above the struct declaration:</p>
<pre><code class="language-C">#pragma pack(1)
// Declare your structs here
#pragma pack(4)
</code></pre>

<p>This will force the alignment to be a multiple of 1B. It will likely make memory access slower, but the struct will be compact.
This allows you to read a struct from a file in one go, instead of element-by-element.</p>

<h2 id="image-with-a-secret">Image with a secret</h2>

<p>Use these images to test your code.</p>

<p>Peppers with a secret:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://cs0449.gitlab.io/fa2024/projects/01/pepper_secret.bmp
</code></pre></div></div>
<p>Peppers without a secret:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://cs0449.gitlab.io/fa2024/projects/01/pepper.bmp
</code></pre></div></div>

<h2 id="bmp-alignment">BMP alignment</h2>

<p>Don’t forget each row of the image must have a number of Bytes multiple of 4!
So if the 3*width is not a multiple of 4, you need to move forwards. Ya know the REMAINDER of the way to 4!</p>

<h2 id="dont-implement-everything-before-testing">Don’t implement EVERYTHING before testing!</h2>

<p>Step 1 is already a simple enough one that allows you to check if you are parsing data correctly. IF any of the numbers printed make no sense, then you’ll know something is wrong.
For example, I forgot one of the struct elements for the header… so the width was TOO large.</p>

<p>Before you attempt to finish Step 2 try something simpler that helps you understand if you are reading the file correctly. I did a bitwise-not (<code class="highlighter-rouge">~</code>) on the blue pixel. Because the whole image turned MORE blue where it was not, and less blue where it was, I knew I had the right data! If the image had turned more green, then I would know I had something wrong.</p>

<p>Step 3 should be VERY similar to Step 2, but you’ll have to open and read 2 files. And then you have to merge the data according to the description.</p>

<h1 id="submission">Submission</h1>

<p>When you’re done, submit your work WITHOUT any sub-folders!</p>
<ul>
  <li>If you have a makefile: Submit the <code class="highlighter-rouge">Makefile</code> and any other files needed to build your code!</li>
  <li>If you don’t have a makefile: Submit a single file named <code class="highlighter-rouge">bmp_steganography.c</code> to Gradescope.</li>
</ul>

<p>When you’re done, submit a file named <code class="highlighter-rouge">bmp_steganography.c</code> to Gradescope.
The testing program will be made available at least 3 days before the deadline.
This is to force you to test your code in thoth!</p>

<p>Testing your code on Gradescope is a terrible practice, DON’T DO IT!
Once submissions are open, you are free to submit as many times as you want.</p>



      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fa2024/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">CS 449</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">CS 449</li><li><a class="u-email" href="mailto:loliveira@pitt.edu">loliveira@pitt.edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/luisfnqoliveira"><svg class="svg-icon"><use xlink:href="/fa2024/assets/minima-social-icons.svg#github"></use></svg> <span class="username">luisfnqoliveira</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>CS 449;
</p>
      </div>
    </div>

  </div>

</footer>



</body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>